<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Tools</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .upload-section {
            text-align: center;
            padding: 40px 20px;
            border: 3px dashed #667eea;
            border-radius: 15px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            background: #f8f9ff;
        }

        .upload-section.dragover {
            border-color: #4CAF50;
            background: #f0fff4;
            transform: scale(1.02);
        }

        .upload-section input[type="file"] {
            display: none;
        }

        .upload-btn {
            display: inline-block;
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .file-info {
            display: none;
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .tool-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .tool-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .tool-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .tool-card p {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .tool-form {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .alert-error {
            background: #ffe6e6;
            color: #d32f2f;
            border-left: 4px solid #d32f2f;
        }

        .alert-success {
            background: #e8f5e8;
            color: #2e7d2e;
            border-left: 4px solid #4CAF50;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .range-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }

        .range-input input {
            flex: 1;
        }

        .range-value {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
        }

        .tool-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                padding: 20px;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PDF Tools</h1>
            <p>Upload a PDF file and choose from our powerful tools</p>
        </div>

        <div class="main-content">
            <!-- Upload Section -->
            <div class="upload-section" id="uploadSection">
                <h2>Upload Your PDF</h2>
                <p>Click to select or drag and drop your PDF file here</p>
                <input type="file" id="pdfUpload" accept=".pdf">
                <label for="pdfUpload" class="upload-btn">Choose PDF File</label>
            </div>

            <!-- File Info -->
            <div class="file-info" id="fileInfo">
                <h3>File Information</h3>
                <div id="fileDetails"></div>
            </div>

            <!-- Tools Grid -->
            <div class="tools-grid" id="toolsGrid">
                <div class="tool-card disabled" data-tool="extract-text">
                    <h3>üìù Extract Text</h3>
                    <p>Extract all text content from your PDF</p>
                </div>

                <div class="tool-card disabled" data-tool="split-pdf">
                    <h3>‚úÇÔ∏è Split PDF</h3>
                    <p>Split your PDF into individual pages or custom page ranges</p>
                </div>

                <div class="tool-card disabled" data-tool="merge-pdfs">
                    <h3>üìö Merge PDFs</h3>
                    <p>Combine multiple PDF files into a single document</p>
                </div>

                <div class="tool-card disabled" data-tool="compress-pdf">
                    <h3>üóúÔ∏è Compress PDF</h3>
                    <p>Reduce file size while maintaining quality</p>
                </div>

                <div class="tool-card disabled" data-tool="add-watermark">
                    <h3>üè∑Ô∏è Add Watermark</h3>
                    <p>Add text watermarks to protect your document</p>
                </div>

                <div class="tool-card disabled" data-tool="rotate-pages">
                    <h3>üîÑ Rotate Pages</h3>
                    <p>Rotate pages by 90, 180, or 270 degrees</p>
                </div>

                <div class="tool-card disabled" data-tool="delete-pages">
                    <h3>üóëÔ∏è Delete Pages</h3>
                    <p>Remove specific pages from your PDF</p>
                </div>

                <div class="tool-card disabled" data-tool="extract-pages">
                    <h3>üìÑ Extract Pages</h3>
                    <p>Extract specific pages into a new PDF document</p>
                </div>

                <div class="tool-card disabled" data-tool="view-metadata">
                    <h3>üìä View Metadata</h3>
                    <p>View detailed information about your PDF file</p>
                </div>

                <div class="tool-card disabled" data-tool="convert-to-images">
                    <h3>üñºÔ∏è Convert to Images</h3>
                    <p>Convert PDF pages to images</p>
                </div>

                <div class="tool-card disabled" data-tool="protect-pdf">
                    <h3>üîí Protect PDF</h3>
                    <p>Add password protection to PDF</p>
                </div>

                <div class="tool-card disabled" data-tool="remove-protection">
                    <h3>üîì Remove Protection</h3>
                    <p>Remove password protection from PDF</p>
                </div>
            </div>

            <!-- Tool Forms Container -->
            <div id="toolFormsContainer"></div>

            <!-- Alerts and Loading -->
            <div class="alert" id="alertBox"></div>
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <p>Processing your request...</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentPDF = null;
        let currentPDFName = '';
        let currentPDFSize = 0;
        let currentTool = null;

        // DOM elements
        const uploadSection = document.getElementById('uploadSection');
        const pdfUpload = document.getElementById('pdfUpload');
        const fileInfo = document.getElementById('fileInfo');
        const fileDetails = document.getElementById('fileDetails');
        const toolsGrid = document.getElementById('toolsGrid');
        const toolFormsContainer = document.getElementById('toolFormsContainer');
        const alertBox = document.getElementById('alertBox');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            // File upload
            pdfUpload.addEventListener('change', handleFileUpload);
            uploadSection.addEventListener('click', () => pdfUpload.click());
            
            // Drag and drop
            uploadSection.addEventListener('dragover', handleDragOver);
            uploadSection.addEventListener('dragleave', handleDragLeave);
            uploadSection.addEventListener('drop', handleDrop);
            
            // Tool cards
            toolsGrid.addEventListener('click', handleToolClick);
        }

        // File handling functions
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file && file.type === 'application/pdf') {
                processPDFFile(file);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            uploadSection.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            uploadSection.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            uploadSection.classList.remove('dragover');
            
            const file = event.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                processPDFFile(file);
            } else {
                showAlert('Please upload a valid PDF file.', 'error');
            }
        }

        function processPDFFile(file) {
            currentPDF = file;
            currentPDFName = file.name;
            currentPDFSize = file.size;
            
            showFileInfo(file);
            enableTools();
            showAlert('PDF file uploaded successfully! Now select a tool to process it.', 'success');
        }

        function showFileInfo(file) {
            fileDetails.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div><strong>Filename:</strong> ${file.name}</div>
                    <div><strong>Size:</strong> ${formatFileSize(file.size)}</div>
                    <div><strong>Type:</strong> ${file.type}</div>
                </div>
            `;
            fileInfo.style.display = 'block';
        }

        function enableTools() {
            const toolCards = document.querySelectorAll('.tool-card.disabled');
            toolCards.forEach(card => {
                card.classList.remove('disabled');
            });
        }

        // Tool handling
        function handleToolClick(event) {
            const toolCard = event.target.closest('.tool-card');
            if (!toolCard || toolCard.classList.contains('disabled')) return;
            
            const tool = toolCard.dataset.tool;
            currentTool = tool;
            showToolForm(tool);
        }

        function showToolForm(tool) {
            // Clear any existing forms
            toolFormsContainer.innerHTML = '';
            
            const form = document.createElement('div');
            form.className = 'tool-form';
            form.id = 'currentToolForm';
            
            form.innerHTML = `
                <h3>${getToolTitle(tool)}</h3>
                <p>${getToolDescription(tool)}</p>
                ${getToolOptions(tool)}
                <div class="tool-actions">
                    <button class="btn-primary" onclick="processTool()">Process</button>
                    <button class="btn-secondary" onclick="cancelTool()">Cancel</button>
                </div>
            `;
            
            toolFormsContainer.appendChild(form);
            
            // Setup tool-specific event listeners
            setupToolEventListeners(tool);
            
            // Scroll to form
            form.scrollIntoView({ behavior: 'smooth' });
        }

        function getToolTitle(tool) {
            const titles = {
                'extract-text': 'Extract Text from PDF',
                'split-pdf': 'Split PDF',
                'merge-pdfs': 'Merge PDF Files',
                'compress-pdf': 'Compress PDF',
                'add-watermark': 'Add Watermark',
                'rotate-pages': 'Rotate Pages',
                'delete-pages': 'Delete Pages',
                'extract-pages': 'Extract Pages',
                'view-metadata': 'View PDF Metadata',
                'convert-to-images': 'Convert to Images',
                'protect-pdf': 'Protect PDF',
                'remove-protection': 'Remove Protection'
            };
            return titles[tool] || 'PDF Tool';
        }

        function getToolDescription(tool) {
            const descriptions = {
                'extract-text': 'Extract all text content from your PDF file.',
                'split-pdf': 'Split your PDF into individual pages or custom page ranges.',
                'merge-pdfs': 'Combine multiple PDF files into a single document.',
                'compress-pdf': 'Reduce file size while maintaining quality.',
                'add-watermark': 'Add text watermarks to protect your document.',
                'rotate-pages': 'Rotate pages by 90, 180, or 270 degrees.',
                'delete-pages': 'Remove specific pages from your PDF.',
                'extract-pages': 'Extract specific pages into a new PDF document.',
                'view-metadata': 'View detailed information about your PDF file.',
                'convert-to-images': 'Convert PDF pages to images.',
                'protect-pdf': 'Add password protection to your PDF.',
                'remove-protection': 'Remove password protection from your PDF.'
            };
            return descriptions[tool] || 'Process your PDF file.';
        }

        function getToolOptions(tool) {
            switch (tool) {
                case 'extract-text':
                    return ''; // No additional options needed
                
                case 'split-pdf':
                    return `
                        <div class="form-group">
                            <label for="splitType">Split Type:</label>
                            <select id="splitType" name="split_type">
                                <option value="pages">Individual Pages</option>
                                <option value="ranges">Page Ranges</option>
                            </select>
                        </div>
                        <div class="form-group" id="pageRangesGroup" style="display: none;">
                            <label for="pageRanges">Page Ranges (e.g., 1-3,5,7-9):</label>
                            <input type="text" id="pageRanges" name="page_ranges" placeholder="1-3,5,7-9">
                        </div>
                    `;
                
                case 'merge-pdfs':
                    return `
                        <div class="form-group">
                            <label for="mergeFiles">Additional PDF files to merge:</label>
                            <input type="file" id="mergeFiles" name="pdf_files" accept=".pdf" multiple>
                        </div>
                    `;
                
                case 'compress-pdf':
                    return `
                        <div class="form-group">
                            <label for="quality">Compression Quality (1-100):</label>
                            <div class="range-input">
                                <input type="range" id="quality" name="quality" min="1" max="100" value="75">
                                <span class="range-value" id="qualityValue">75</span>
                            </div>
                        </div>
                    `;
                
                case 'add-watermark':
                    return `
                        <div class="form-group">
                            <label for="watermarkText">Watermark Text:</label>
                            <input type="text" id="watermarkText" name="watermark_text" value="WATERMARK" required>
                        </div>
                        <div class="form-group">
                            <label for="opacity">Opacity (0-1):</label>
                            <div class="range-input">
                                <input type="range" id="opacity" name="opacity" min="0" max="1" step="0.1" value="0.3">
                                <span class="range-value" id="opacityValue">0.3</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="position">Position:</label>
                            <select id="position" name="position">
                                <option value="center">Center</option>
                                <option value="top-left">Top Left</option>
                                <option value="top-right">Top Right</option>
                                <option value="bottom-left">Bottom Left</option>
                                <option value="bottom-right">Bottom Right</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="fontSize">Font Size:</label>
                            <input type="number" id="fontSize" name="font_size" min="10" max="100" value="50">
                        </div>
                    `;
                
                case 'rotate-pages':
                    return `
                        <div class="form-group">
                            <label for="rotation">Rotation:</label>
                            <select id="rotation" name="rotation">
                                <option value="90">90¬∞ Clockwise</option>
                                <option value="180">180¬∞</option>
                                <option value="270">270¬∞ Clockwise</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="pagesToRotate">Pages to Rotate (comma-separated, or leave empty for all):</label>
                            <input type="text" id="pagesToRotate" name="pages" placeholder="e.g., 1,3,5-7">
                        </div>
                    `;
                
                case 'delete-pages':
                    return `
                        <div class="form-group">
                            <label for="pagesToDelete">Pages to Delete (comma-separated):</label>
                            <input type="text" id="pagesToDelete" name="pages_to_delete" required placeholder="e.g., 1,3,5-7">
                        </div>
                    `;
                
                case 'extract-pages':
                    return `
                        <div class="form-group">
                            <label for="pagesToExtract">Pages to Extract (comma-separated or ranges):</label>
                            <input type="text" id="pagesToExtract" name="pages_to_extract" required placeholder="e.g., 1,3,5-7">
                        </div>
                    `;
                
                case 'view-metadata':
                    return ''; // No additional options needed
                
                case 'convert-to-images':
                    return `
                        <div class="form-group">
                            <label for="format">Image Format:</label>
                            <select id="format" name="format">
                                <option value="PNG">PNG</option>
                                <option value="JPEG">JPEG</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dpi">DPI (Resolution):</label>
                            <input type="number" id="dpi" name="dpi" min="72" max="600" value="150">
                        </div>
                    `;
                
                case 'protect-pdf':
                    return `
                        <div class="form-group">
                            <label for="userPassword">User Password (for opening):</label>
                            <input type="password" id="userPassword" name="user_password">
                        </div>
                        <div class="form-group">
                            <label for="ownerPassword">Owner Password (for permissions):</label>
                            <input type="password" id="ownerPassword" name="owner_password">
                        </div>
                    `;
                
                case 'remove-protection':
                    return `
                        <div class="form-group">
                            <label for="password">Password:</label>
                            <input type="password" id="password" name="password" required>
                        </div>
                    `;
                
                default:
                    return '<p>No options available for this tool.</p>';
            }
        }

        function setupToolEventListeners(tool) {
            switch (tool) {
                case 'split-pdf':
                    const splitType = document.getElementById('splitType');
                    if (splitType) {
                        splitType.addEventListener('change', function() {
                            const pageRangesGroup = document.getElementById('pageRangesGroup');
                            pageRangesGroup.style.display = this.value === 'ranges' ? 'block' : 'none';
                        });
                    }
                    break;
                
                case 'compress-pdf':
                    const quality = document.getElementById('quality');
                    if (quality) {
                        quality.addEventListener('input', function() {
                            document.getElementById('qualityValue').textContent = this.value;
                        });
                    }
                    break;
                
                case 'add-watermark':
                    const opacity = document.getElementById('opacity');
                    if (opacity) {
                        opacity.addEventListener('input', function() {
                            document.getElementById('opacityValue').textContent = this.value;
                        });
                    }
                    break;
            }
        }

        function processTool() {
            if (!currentPDF || !currentTool) return;
            
            const formData = new FormData();
            formData.append('pdf_file', currentPDF);
            
            // Add tool-specific form data
            switch (currentTool) {
                case 'split-pdf':
                    const splitType = document.getElementById('splitType');
                    if (splitType) formData.append('split_type', splitType.value);
                    
                    if (splitType && splitType.value === 'ranges') {
                        const pageRanges = document.getElementById('pageRanges');
                        if (pageRanges) formData.append('page_ranges', pageRanges.value);
                    }
                    break;
                
                case 'merge-pdfs':
                    const mergeFiles = document.getElementById('mergeFiles');
                    if (mergeFiles && mergeFiles.files.length > 0) {
                        for (let i = 0; i < mergeFiles.files.length; i++) {
                            formData.append('pdf_files', mergeFiles.files[i]);
                        }
                    }
                    break;
                
                case 'compress-pdf':
                    const quality = document.getElementById('quality');
                    if (quality) formData.append('quality', quality.value);
                    break;
                
                case 'add-watermark':
                    const watermarkText = document.getElementById('watermarkText');
                    if (watermarkText) formData.append('watermark_text', watermarkText.value);
                    
                    const opacity = document.getElementById('opacity');
                    if (opacity) formData.append('opacity', opacity.value);
                    
                    const position = document.getElementById('position');
                    if (position) formData.append('position', position.value);
                    
                    const fontSize = document.getElementById('fontSize');
                    if (fontSize) formData.append('font_size', fontSize.value);
                    break;
                
                case 'rotate-pages':
                    const rotation = document.getElementById('rotation');
                    if (rotation) formData.append('rotation', rotation.value);
                    
                    const pagesToRotate = document.getElementById('pagesToRotate');
                    if (pagesToRotate) formData.append('pages', pagesToRotate.value);
                    break;
                
                case 'delete-pages':
                    const pagesToDelete = document.getElementById('pagesToDelete');
                    if (pagesToDelete) formData.append('pages_to_delete', pagesToDelete.value);
                    break;
                
                case 'extract-pages':
                    const pagesToExtract = document.getElementById('pagesToExtract');
                    if (pagesToExtract) formData.append('pages_to_extract', pagesToExtract.value);
                    break;
                
                case 'convert-to-images':
                    const format = document.getElementById('format');
                    if (format) formData.append('format', format.value);
                    
                    const dpi = document.getElementById('dpi');
                    if (dpi) formData.append('dpi', dpi.value);
                    break;
                
                case 'protect-pdf':
                    const userPassword = document.getElementById('userPassword');
                    if (userPassword) formData.append('user_password', userPassword.value);
                    
                    const ownerPassword = document.getElementById('ownerPassword');
                    if (ownerPassword) formData.append('owner_password', ownerPassword.value);
                    break;
                
                case 'remove-protection':
                    const password = document.getElementById('password');
                    if (password) formData.append('password', password.value);
                    break;
            }
            
            // Determine the endpoint based on the selected tool
            const endpoint = `/${currentTool.replace(/-/g, '_')}/`;
            
            // Show loading, hide any previous alerts
            loadingIndicator.style.display = 'block';
            alertBox.style.display = 'none';
            
            fetch(endpoint, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                }
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => { throw err; });
                }
                
                // Handle different response types
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    return response.json();
                } else if (contentType && (contentType.includes('application/pdf') || 
                                           contentType.includes('application/zip') || 
                                           contentType.includes('text/plain'))) {
                    return response.blob().then(blob => {
                        return { blob, filename: getFilenameFromResponse(response) };
                    });
                } else {
                    return response.text();
                }
            })
            .then(data => {
                if (data.blob) {
                    // Download file
                    const url = window.URL.createObjectURL(data.blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = data.filename || 'download';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    
                    showAlert('Operation completed successfully! File download started.', 'success');
                } else if (data.metadata) {
                    // Display metadata
                    let metadataHTML = '<h3>PDF Metadata:</h3><table style="width:100%;border-collapse:collapse;margin-top:15px;"><tbody>';
                    for (const [key, value] of Object.entries(data.metadata)) {
                        metadataHTML += `<tr><td style="padding:8px;border-bottom:1px solid #ddd;font-weight:bold">${key.replace(/_/g, ' ').toUpperCase()}</td><td style="padding:8px;border-bottom:1px solid #ddd">${value}</td></tr>`;
                    }
                    metadataHTML += '</tbody></table>';
                    
                    showAlert(metadataHTML, 'success');
                } else if (data.error) {
                    throw new Error(data.error);
                }
            })
            .catch(error => {
                showAlert(error.message || 'An error occurred', 'error');
            })
            .finally(() => {
                loadingIndicator.style.display = 'none';
            });
        }

        function cancelTool() {
            toolFormsContainer.innerHTML = '';
            currentTool = null;
        }

        function showAlert(message, type) {
            alertBox.innerHTML = message;
            alertBox.className = `alert alert-${type}`;
            alertBox.style.display = 'block';
            
            // Scroll to alert
            alertBox.scrollIntoView({ behavior: 'smooth' });
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Extract filename from Content-Disposition header
        function getFilenameFromResponse(response) {
            const contentDisposition = response.headers.get('Content-Disposition');
            if (contentDisposition) {
                const filenameMatch = contentDisposition.match(/filename="?(.+)"?/);
                if (filenameMatch && filenameMatch.length > 1) {
                    return filenameMatch[1];
                }
            }
            return 'download';
        }
    </script>
</body>
</html>
